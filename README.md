# Teleprompter Recording & Editing Suite

All-in-one teleprompter, recording, and video editing experience powered by Expo (React Native) plus a lightweight Node.js backend that generates AWS S3 presigned URLs.

---

## Overview

- Record scripted videos while a teleprompter scrolls your text.
- Edit clips offline with trimming, overlays, stickers, transitions, and audio mixing.
- Upload finished videos to AWS S3 using the included Express backend.
- Run on iOS, Android, web (via Expo), and supports desktop simulators/emulators.

---

## Repository Layout

```
teleprompter-module-teleprompter-app/
‚îú‚îÄ‚îÄ app/                 # Expo Router app (React Native + TypeScript)
‚îú‚îÄ‚îÄ backend/             # Express server for S3 presigned URL generation
‚îú‚îÄ‚îÄ android/             # Native Android project (generated by Expo prebuild)
‚îú‚îÄ‚îÄ ios/                 # Native iOS project (generated by Expo prebuild)
‚îú‚îÄ‚îÄ assets/              # Fonts, images, music, lottie animations
‚îú‚îÄ‚îÄ config/              # App-level configuration helpers
‚îî‚îÄ‚îÄ utils/               # Shared utilities (AWS services, FFmpeg helpers, etc.)
```

---

## Core Features

- **Teleprompter-first capture**: adjustable scroll speed, font sizing, portrait/landscape modes.
- **Recording controls**: camera/mic permissions, pause & resume, front/back switching.
- **Offline editing**: clip trimming, splits, transitions, text & sticker overlays, audio mixing.
- **Music library**: curated background tracks bundled in `assets/music`.
- **Upload workflow**: optional AWS S3 upload with auto-expiry metadata.
- **Settings & persistence**: feature toggles, video defaults, AWS credentials stored securely in AsyncStorage.

---

## Requirements

- Node.js 18 LTS or Node.js 20 (Expo SDK 54 requirement)
- npm 9+ (ships with Node 18/20)  
  *Yarn works too, but instructions below use npm.*
- Expo CLI (optional): `npm install -g expo-cli` or rely on `npx expo`
- Android Studio (emulator + SDK) for Android testing
- Xcode + CocoaPods (macOS only) for iOS builds
- AWS account with S3 access (only if you plan to use cloud uploads)

---

## Installation

```powershell
# 1. Clone
git clone <repository-url> teleprompter-app
cd teleprompter-app

# 2. Install shared Expo dependencies
npm install

# 3. Install backend dependencies
cd backend
npm install
cd ..
```

> üí° On Windows PowerShell, run commands exactly as shown. If you prefer Command Prompt, drop the `\` line continuations.

---

## Backend Setup (Express + AWS S3)

The backend listens on `PORT` (defaults to `3000`) and exposes:

- `GET /health` for environment diagnostics
- `POST /api/get-presigned-url` to return a presigned PUT URL

### 1. Create `backend/.env`

| Variable | Required | Description |
| --- | --- | --- |
| `PORT` | No | Defaults to `3000`. Change if the port is in use. |
| `AWS_REGION` | Yes | Region of your bucket, e.g. `us-east-1`. |
| `AWS_S3_BUCKET` | Yes | Name of the target bucket. |
| `AWS_S3_PREFIX` | No | Key prefix, defaults to `user-uploads/`. |
| `AWS_ACCESS_KEY_ID` | Conditionally | Required unless the server runs with IAM permissions. |
| `AWS_SECRET_ACCESS_KEY` | Conditionally | Required unless the server runs with IAM permissions. |
| `PRESIGNED_URL_EXPIRY` | No | Seconds until URL expires (default `900`, i.e. 15 minutes). |

**Example `.env`:**

```
PORT=3000
AWS_REGION=us-east-1
AWS_S3_BUCKET=startuppal-video-storage
AWS_S3_PREFIX=user-uploads/
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=your-secret
PRESIGNED_URL_EXPIRY=900
```

> ‚ÑπÔ∏è If you deploy to AWS infrastructure (EC2, ECS, etc.) with proper IAM roles, you can omit the access key and secret.

### 2. Start the server

```powershell
cd backend
npm run dev      # nodemon hot-reload
# or npm start   # plain node server
```

If port `3000` is already in use, set another value before starting:

```powershell
$env:PORT="4000"
npm start
```

### 3. Verify the server

Open a browser or `curl`:

```
http://localhost:3000/health
```

You should see the configuration summary including bucket, region, and expiry.

- Confirm `bucket` is `startuppal-video-storage` and `prefix` is `user-uploads/` (or your chosen values).

---

## Frontend Setup (Expo App)

### Configure backend URL inside the app

The mobile app expects the backend base URL when it requests presigned URLs.

- Default fallback lives in `utils/awsS3Service.ts` (search for `BACKEND_URL`). Update it to your local IP and port if needed.
- Inside the app, open the Settings screen ‚Üí AWS Configuration and set:
  - Backend URL (e.g. `http://192.168.0.25:3000`)
  - Bucket, region, access key, secret key (if you want device-side uploads)

- For backend-generated uploads, keep "Use Backend Server" ON. To upload without the backend, turn this OFF and provide valid AWS credentials; the app will generate presigned URLs on-device.

### Run the Expo Dev Server

```powershell
cd teleprompter-app
npm run start           # launches Expo CLI dashboard
```

From the Expo terminal UI:

- Press `a` for Android emulator/device
- Press `i` for iOS simulator (macOS)
- Press `w` for web browser
- Scan the QR code with Expo Go on a physical device

### Build commands

```powershell
npm run android   # expo run:android
npm run ios       # expo run:ios (macOS + Xcode)
npm run web       # expo start --web
```

For production builds use EAS:

```powershell
npx eas build --platform android
npx eas build --platform ios
```

---

## End-to-End Run Checklist

1. **Backend terminal**
   - `cd backend`
   - `.env` configured
   - `npm run dev`
   - Confirm `/health` responds
2. **Frontend terminal**
   - `cd teleprompter-app`
   - `npm run start`
   - Configure backend URL inside the app (Settings)
   - Start recording/editing
3. **Upload test**
   - Finish a video and trigger upload
   - Monitor console logs (backend + Expo) for presigned URL activity
   - Verify object in S3 bucket

---

## AWS S3 & Security Notes

- Uploaded videos receive metadata marking the upload timestamp; you can enforce lifecycle rules (e.g., auto-delete after 7 days) directly in S3.
- Keep your `.env` out of version control. Add sensitive values to a secrets manager for production environments.
- When testing on a device, the backend URL must point to your machine‚Äôs LAN IP (e.g., `http://192.168.x.x:3000`), not `localhost`.

---

## Upload Behavior

- Default uploads request a presigned PUT URL from the backend.
- The backend must be reachable from the device; use `http://<your-PC-IP>:3000`, not `localhost`.
- Without the backend, uploads only work if "Use Backend Server" is OFF and valid `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_S3_BUCKET`, and `AWS_REGION` are saved in the app‚Äôs AWS Settings. In that case, the app generates presigned URLs on-device.
- Recommended for production: use the backend for presigned URLs to avoid exposing long-lived credentials on devices.

---

## Troubleshooting

- **`EADDRINUSE: address already in use :::3000`**  
  Another process is listening on the same port. Either stop that process (`taskkill /PID <pid> /F` on Windows) or change `PORT` in `.env`.

- **Expo app cannot reach backend**  
  Ensure the device is on the same network and the backend URL uses your computer‚Äôs IP address. Check firewalls and antivirus rules.

- **AWS request returns `500`**  
  Missing `AWS_S3_BUCKET` or invalid credentials. Revisit `backend/.env` and restart the server.

- **Large uploads fail**  
  Increase `PRESIGNED_URL_EXPIRY` to allow more time, and verify your network connection.

- **Uploads going to the wrong bucket (e.g., `softcodec/videos`)**  
  Verify which backend the app is calling. Check `GET /health` shows the expected `bucket` and `prefix`. Stop any legacy server using old config and ensure the app‚Äôs AWS Settings point to the correct backend URL.

---

## Support

For questions or integration help:

- Review `BACKEND_INTEGRATION_GUIDE.md` for advanced AWS setup tips.
- Check `utils/awsS3Service.ts` and `config/appConfig.ts` to understand configuration flows.
- Reach out to the development team with logs, device details, and reproduction steps.
